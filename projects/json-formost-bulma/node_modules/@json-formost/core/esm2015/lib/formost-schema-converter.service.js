import { Injectable } from '@angular/core';
import { of } from 'rxjs';
import { FormGroup } from './controls/form-group';
import { FormArray } from './controls/form-array';
import { FormControl } from './controls/form-control';
import * as i0 from "@angular/core";
export class SchemaConverterService {
    constructor() { }
    getFormostForm(schema) {
        let formItems = this.getFormItems(schema, "#");
        if (formItems instanceof FormGroup)
            return formItems;
        else {
            return new FormGroup({ formost: formItems });
        }
    }
    getFormostForm$(schema) {
        return of(this.getFormostForm(schema));
    }
    getFormostAbstractControl(schema, refId = "#") {
        let formItems = this.getFormItems(schema, refId);
        return formItems;
    }
    getFormostAbstractControl$(schema, refId = "#") {
        return of(this.getFormostAbstractControl(schema, refId));
    }
    getFormItems(schema, refId = "#") {
        const schemaObj = typeof schema === 'string' ? JSON.parse(schema) : schema;
        if (!schemaObj) {
            console.warn('NO-OBJECT', schemaObj);
            return {};
        }
        if (!schemaObj.type) {
            console.warn('NO-TYPE', schemaObj);
            return {};
        }
        let formItems;
        switch (schemaObj.type) {
            case 'null':
                return null;
            case 'object':
                formItems = this.getFormGroup(schemaObj, refId);
                break;
            case 'array':
                formItems = this.getFormArray(schemaObj, refId);
                break;
            default:
                formItems = this.getFormControl(schemaObj, refId);
                break;
        }
        return formItems;
    }
    getFormControl(obj, refId) {
        const formCtl = new FormControl(obj);
        // formCtl.populate(obj);
        if (refId) {
            formCtl.refid = refId;
        }
        return formCtl;
    }
    getFormGroup(obj, refId) {
        const reqArr = obj.required || [];
        const item = new FormGroup({});
        item.populate(obj);
        if (refId) {
            item.refid = refId;
        }
        for (const prop in obj.properties) {
            if (obj.properties.hasOwnProperty(prop)) {
                const unknownField = obj.properties[prop];
                unknownField.name = prop;
                if (reqArr.indexOf(prop) > -1) {
                    unknownField.required = true;
                }
                const knownField = this.getFormItems(unknownField, `${refId}/fields/${prop}`);
                //item.fields.push(knownField);
                item.addControl(prop, knownField);
            }
        }
        return item;
    }
    getFormArray(obj, refId) {
        const item = new FormArray([], undefined, undefined, this);
        item.populate(obj);
        if (refId) {
            item.refid = refId;
        }
        const allowedTypesArray = Array.isArray(obj.items)
            ? obj.items
            : [obj.items];
        // let i = 0;
        // for (const allowedType of allowedTypesArray) {
        //     // ++i;
        //     // allowedType.name = allowedType.name || `${obj.name ? obj.name + '-' : null}type-${i}`;
        //     // item.itemTypes.push(this.getFormItems(allowedType, `${refId}/itemTypes/${allowedType.name}`) as FormField);
        //     item.itemTypes.push(this.getFormItems(allowedType, `${refId}/itemTypes/[${i++}]`) as FormControl);
        // }
        item.itemTypes = allowedTypesArray;
        return item;
    }
}
SchemaConverterService.ɵprov = i0.ɵɵdefineInjectable({ factory: function SchemaConverterService_Factory() { return new SchemaConverterService(); }, token: SchemaConverterService, providedIn: "root" });
SchemaConverterService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root'
            },] }
];
SchemaConverterService.ctorParameters = () => [];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm9ybW9zdC1zY2hlbWEtY29udmVydGVyLnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9wcm9qZWN0cy9qc29uLWZvcm1vc3QtY29yZS9zcmMvbGliL2Zvcm1vc3Qtc2NoZW1hLWNvbnZlcnRlci5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFFLEVBQUUsRUFBYyxNQUFNLE1BQU0sQ0FBQztBQUd0QyxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDbEQsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQ2xELE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQzs7QUFNdEQsTUFBTSxPQUFPLHNCQUFzQjtJQUVqQyxnQkFBZ0IsQ0FBQztJQUVqQixjQUFjLENBQUMsTUFBbUM7UUFDaEQsSUFBSSxTQUFTLEdBQTJCLElBQUksQ0FBQyxZQUFZLENBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBQyxDQUFDO1FBRXZFLElBQUksU0FBUyxZQUFZLFNBQVM7WUFDaEMsT0FBTyxTQUFTLENBQUM7YUFDZDtZQUNILE9BQU8sSUFBSSxTQUFTLENBQUMsRUFBRSxPQUFPLEVBQUUsU0FBUyxFQUFFLENBQUMsQ0FBQztTQUM5QztJQUNILENBQUM7SUFFRCxlQUFlLENBQUMsTUFBbUM7UUFDakQsT0FBTyxFQUFFLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO0lBQ3pDLENBQUM7SUFFRCx5QkFBeUIsQ0FBQyxNQUFtQyxFQUFFLEtBQUssR0FBRyxHQUFHO1FBQ3hFLElBQUksU0FBUyxHQUEyQixJQUFJLENBQUMsWUFBWSxDQUFDLE1BQU0sRUFBRSxLQUFLLENBQUMsQ0FBQztRQUN6RSxPQUFPLFNBQVMsQ0FBQztJQUNuQixDQUFDO0lB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Q0FBQyxHQUF1QixFQUFFLEtBQWE7UUFDekQsTUFBTSxJQUFJLEdBQUcsSUFBSSxTQUFTLENBQUMsRUFBRSxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDM0QsSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNuQixJQUFJLEtBQUssRUFBRTtZQUFFLElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO1NBQUU7UUFDbEMsTUFBTSxpQkFBaUIsR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUM7WUFDaEQsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxLQUE2QjtZQUNuQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsS0FBMkIsQ0FBQyxDQUFDO1FBQ3RDLGFBQWE7UUFDYixpREFBaUQ7UUFDakQsY0FBYztRQUNkLGdHQUFnRztRQUNoRyxxSEFBcUg7UUFDckgseUdBQXlHO1FBQ3pHLElBQUk7UUFDSixJQUFJLENBQUMsU0FBUyxHQUFHLGlCQUFpQixDQUFDO1FBQ25DLE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQzs7OztZQTdGRixVQUFVLFNBQUM7Z0JBQ1YsVUFBVSxFQUFFLE1BQU07YUFDbkIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBvZiwgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xuXG5pbXBvcnQgeyBGb3Jtb3N0QWJzdHJhY3RDb250cm9sIH0gZnJvbSAnLi9mb3Jtb3N0LWFic3RyYWN0LWNvbnRyb2wuaW50ZXJmYWNlJztcbmltcG9ydCB7IEZvcm1Hcm91cCB9IGZyb20gJy4vY29udHJvbHMvZm9ybS1ncm91cCc7XG5pbXBvcnQgeyBGb3JtQXJyYXkgfSBmcm9tICcuL2NvbnRyb2xzL2Zvcm0tYXJyYXknO1xuaW1wb3J0IHsgRm9ybUNvbnRyb2wgfSBmcm9tICcuL2NvbnRyb2xzL2Zvcm0tY29udHJvbCc7XG5pbXBvcnQgeyBGb3Jtb3N0SnNvblNjaGVtYTcgfSBmcm9tICcuL2Zvcm1vc3QtanNvbi1zY2hlbWEtNy5pbnRlcmZhY2UnO1xuXG5ASW5qZWN0YWJsZSh7XG4gIHByb3ZpZGVkSW46ICdyb290J1xufSlcbmV4cG9ydCBjbGFzcyBTY2hlbWFDb252ZXJ0ZXJTZXJ2aWNlIHtcblxuICBjb25zdHJ1Y3RvcigpIHsgfVxuXG4gIGdldEZvcm1vc3RGb3JtKHNjaGVtYTogRm9ybW9zdEpzb25TY2hlbWE3IHwgc3RyaW5nKTogRm9ybUdyb3VwIHtcbiAgICBsZXQgZm9ybUl0ZW1zOiBGb3Jtb3N0QWJzdHJhY3RDb250cm9sID0gdGhpcy5nZXRGb3JtSXRlbXMoc2NoZW1hLCBcIiNcIik7XG5cbiAgICBpZiAoZm9ybUl0ZW1zIGluc3RhbmNlb2YgRm9ybUdyb3VwKVxuICAgICAgcmV0dXJuIGZvcm1JdGVtcztcbiAgICBlbHNlIHtcbiAgICAgIHJldHVybiBuZXcgRm9ybUdyb3VwKHsgZm9ybW9zdDogZm9ybUl0ZW1zIH0pO1xuICAgIH1cbiAgfVxuXG4gIGdldEZvcm1vc3RGb3JtJChzY2hlbWE6IEZvcm1vc3RKc29uU2NoZW1hNyB8IHN0cmluZyk6IE9ic2VydmFibGU8Rm9ybUdyb3VwPiB7XG4gICAgcmV0dXJuIG9mKHRoaXMuZ2V0Rm9ybW9zdEZvcm0oc2NoZW1hKSk7XG4gIH1cblxuICBnZXRGb3Jtb3N0QWJzdHJhY3RDb250cm9sKHNjaGVtYTogRm9ybW9zdEpzb25TY2hlbWE3IHwgc3RyaW5nLCByZWZJZCA9IFwiI1wiKTogRm9ybW9zdEFic3RyYWN0Q29udHJvbCB7XG4gICAgbGV0IGZvcm1JdGVtczogRm9ybW9zdEFic3RyYWN0Q29udHJvbCA9IHRoaXMuZ2V0Rm9ybUl0ZW1zKHNjaGVtYSwgcmVmSWQpO1xuICAgIHJldHVybiBmb3JtSXRlbXM7XG4gIH1cblxuICBnZXRGb3Jtb3N0QWJzdHJhY3RDb250cm9sJChzY2hlbWE6IEZvcm1vc3RKc29uU2NoZW1hNyB8IHN0cmluZywgcmVmSWQgPSBcIiNcIik6IE9ic2VydmFibGU8Rm9ybW9zdEFic3RyYWN0Q29udHJvbD4ge1xuICAgIHJldHVybiBvZih0aGlzLmdldEZvcm1vc3RBYnN0cmFjdENvbnRyb2woc2NoZW1hLCByZWZJZCkpO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRGb3JtSXRlbXMoc2NoZW1hOiBGb3Jtb3N0SnNvblNjaGVtYTcgfCBzdHJpbmcsIHJlZklkID0gXCIjXCIpOiBGb3Jtb3N0QWJzdHJhY3RDb250cm9sIHtcbiAgICBjb25zdCBzY2hlbWFPYmo6IEZvcm1vc3RKc29uU2NoZW1hNyA9IHR5cGVvZiBzY2hlbWEgPT09ICdzdHJpbmcnID8gSlNPTi5wYXJzZShzY2hlbWEpIDogc2NoZW1hO1xuXG4gICAgaWYgKCFzY2hlbWFPYmopIHsgY29uc29sZS53YXJuKCdOTy1PQkpFQ1QnLCBzY2hlbWFPYmopOyByZXR1cm4ge30gYXMgRm9ybW9zdEFic3RyYWN0Q29udHJvbDsgfVxuICAgIGlmICghc2NoZW1hT2JqLnR5cGUpIHsgY29uc29sZS53YXJuKCdOTy1UWVBFJywgc2NoZW1hT2JqKTsgcmV0dXJuIHt9IGFzIEZvcm1vc3RBYnN0cmFjdENvbnRyb2w7IH1cblxuICAgIGxldCBmb3JtSXRlbXM6IEZvcm1vc3RBYnN0cmFjdENvbnRyb2w7XG4gICAgc3dpdGNoIChzY2hlbWFPYmoudHlwZSkge1xuICAgICAgY2FzZSAnbnVsbCc6XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgZm9ybUl0ZW1zID0gdGhpcy5nZXRGb3JtR3JvdXAoc2NoZW1hT2JqLCByZWZJZCk7IGJyZWFrO1xuICAgICAgY2FzZSAnYXJyYXknOlxuICAgICAgICBmb3JtSXRlbXMgPSB0aGlzLmdldEZvcm1BcnJheShzY2hlbWFPYmosIHJlZklkKTsgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBmb3JtSXRlbXMgPSB0aGlzLmdldEZvcm1Db250cm9sKHNjaGVtYU9iaiwgcmVmSWQpOyBicmVhaztcbiAgICB9XG5cbiAgICByZXR1cm4gZm9ybUl0ZW1zO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRGb3JtQ29udHJvbChvYmo6IEZvcm1vc3RKc29uU2NoZW1hNywgcmVmSWQ6IHN0cmluZyk6IEZvcm1Db250cm9sIHtcbiAgICBjb25zdCBmb3JtQ3RsID0gbmV3IEZvcm1Db250cm9sKG9iaik7XG4gICAgLy8gZm9ybUN0bC5wb3B1bGF0ZShvYmopO1xuICAgIGlmIChyZWZJZCkgeyBmb3JtQ3RsLnJlZmlkID0gcmVmSWQ7IH1cbiAgICByZXR1cm4gZm9ybUN0bDtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0Rm9ybUdyb3VwKG9iajogRm9ybW9zdEpzb25TY2hlbWE3LCByZWZJZDogc3RyaW5nKTogRm9ybUdyb3VwIHtcbiAgICBjb25zdCByZXFBcnI6IEFycmF5PHN0cmluZz4gPSBvYmoucmVxdWlyZWQgfHwgW107XG4gICAgY29uc3QgaXRlbSA9IG5ldyBGb3JtR3JvdXAoe30pO1xuICAgIGl0ZW0ucG9wdWxhdGUob2JqKTtcbiAgICBpZiAocmVmSWQpIHsgaXRlbS5yZWZpZCA9IHJlZklkOyB9XG4gICAgZm9yIChjb25zdCBwcm9wIGluIG9iai5wcm9wZXJ0aWVzKSB7XG4gICAgICBpZiAob2JqLnByb3BlcnRpZXMuaGFzT3duUHJvcGVydHkocHJvcCkpIHtcbiAgICAgICAgY29uc3QgdW5rbm93bkZpZWxkID0gb2JqLnByb3BlcnRpZXNbcHJvcF0gYXMgYW55O1xuICAgICAgICB1bmtub3duRmllbGQubmFtZSA9IHByb3A7XG4gICAgICAgIGlmIChyZXFBcnIuaW5kZXhPZihwcm9wKSA+IC0xKSB7IHVua25vd25GaWVsZC5yZXF1aXJlZCA9IHRydWU7IH1cblxuICAgICAgICBjb25zdCBrbm93bkZpZWxkID0gdGhpcy5nZXRGb3JtSXRlbXModW5rbm93bkZpZWxkLCBgJHtyZWZJZH0vZmllbGRzLyR7cHJvcH1gKTtcbiAgICAgICAgLy9pdGVtLmZpZWxkcy5wdXNoKGtub3duRmllbGQpO1xuICAgICAgICBpdGVtLmFkZENvbnRyb2wocHJvcCwga25vd25GaWVsZCk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBpdGVtO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRGb3JtQXJyYXkob2JqOiBGb3Jtb3N0SnNvblNjaGVtYTcsIHJlZklkOiBzdHJpbmcpOiBGb3JtQXJyYXkge1xuICAgIGNvbnN0IGl0ZW0gPSBuZXcgRm9ybUFycmF5KFtdLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgdGhpcyk7XG4gICAgaXRlbS5wb3B1bGF0ZShvYmopO1xuICAgIGlmIChyZWZJZCkgeyBpdGVtLnJlZmlkID0gcmVmSWQ7IH1cbiAgICBjb25zdCBhbGxvd2VkVHlwZXNBcnJheSA9IEFycmF5LmlzQXJyYXkob2JqLml0ZW1zKVxuICAgICAgPyBvYmouaXRlbXMgYXMgRm9ybW9zdEpzb25TY2hlbWE3W11cbiAgICAgIDogW29iai5pdGVtcyBhcyBGb3Jtb3N0SnNvblNjaGVtYTddO1xuICAgIC8vIGxldCBpID0gMDtcbiAgICAvLyBmb3IgKGNvbnN0IGFsbG93ZWRUeXBlIG9mIGFsbG93ZWRUeXBlc0FycmF5KSB7XG4gICAgLy8gICAgIC8vICsraTtcbiAgICAvLyAgICAgLy8gYWxsb3dlZFR5cGUubmFtZSA9IGFsbG93ZWRUeXBlLm5hbWUgfHwgYCR7b2JqLm5hbWUgPyBvYmoubmFtZSArICctJyA6IG51bGx9dHlwZS0ke2l9YDtcbiAgICAvLyAgICAgLy8gaXRlbS5pdGVtVHlwZXMucHVzaCh0aGlzLmdldEZvcm1JdGVtcyhhbGxvd2VkVHlwZSwgYCR7cmVmSWR9L2l0ZW1UeXBlcy8ke2FsbG93ZWRUeXBlLm5hbWV9YCkgYXMgRm9ybUZpZWxkKTtcbiAgICAvLyAgICAgaXRlbS5pdGVtVHlwZXMucHVzaCh0aGlzLmdldEZvcm1JdGVtcyhhbGxvd2VkVHlwZSwgYCR7cmVmSWR9L2l0ZW1UeXBlcy9bJHtpKyt9XWApIGFzIEZvcm1Db250cm9sKTtcbiAgICAvLyB9XG4gICAgaXRlbS5pdGVtVHlwZXMgPSBhbGxvd2VkVHlwZXNBcnJheTtcbiAgICByZXR1cm4gaXRlbTtcbiAgfVxuXG59XG4iXX0=